<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="/main.css" rel="stylesheet"> 
</head>
<body class="grey-bg">
    <%- include('navbar.ejs') %>
    <div class="white-bg">
        <% for (let i = 0; i < ê¸€ëª©ë¡.length; i++){  %> <!--html ì‚¬ì´ì— jsë¬¸ë²• ì“¸ ë•Œ-->
            <div class="list-box">
                <h4><a href="/detail/<%= ê¸€ëª©ë¡[i]._id %>"><%= ê¸€ëª©ë¡[i].title %></a> <!--ì œëª© ë¶€ë¶„ì— ìƒì„¸í˜ì´ì§€ ë§í¬ ê±¸ê¸°-->
                    <a href="/edit/<%= ê¸€ëª©ë¡[i]._id %>">âœï¸</a>
                    <span class="delete" data-id="<%= ê¸€ëª©ë¡[i]._id %>">ğŸ—‘ï¸</span>
                </h4> 
                <p><%= ê¸€ëª©ë¡[i].content %></p> <!--ë°›ì€ ë°ì´í„°ë¥¼ ejsíŒŒì¼ ì•ˆì— ê½‚ì•„ë„£ê¸°-->
            </div>
        <% } %>
    </div>
    <script> //html ì›¹í˜ì´ì§€ì— ì¡°ì‘ì„ ê°€í–ˆì„ ë•Œ íŠ¹ì • ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê³  ì‹¶ë‹¤ë©´ (ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¬¸ë²• ì‚¬ìš©)
    for (let i = 0; i < '<%= ê¸€ëª©ë¡.length %>'; i++){
        document.querySelectorAll('.delete')[i] //class="delete"ê°€ì§„ html ìš”ì†Œ ì¤‘ 0ë²ˆì§¸ ì°¾ê¸°
        .addEventListener('click', function(e){ //ê·¸ê²Œ í´ë¦­ë˜ë©´ ì•„ë˜ì˜ ì½”ë“œ ì‹¤í–‰
            e.target.dataset.id //ìœ ì €ê°€ ì§€ê¸ˆ í´ë¦­í•œ ìš”ì†Œ
            fetch('/delete?docid' + e.target.dataset.id, { //form íƒœê·¸ ëŒ€ì‹  Ajax: ì „ì²´í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì—†ì´ ì„œë²„ì— ìš”ì²­ -> í•„ìš”í•œ ë¶€ë¶„ë§Œ ì—…ë°ì´íŠ¸ ê°€ëŠ¥
            //ë™ì ìœ¼ë¡œ ê¸°ëŠ¥(ì •ì ìœ¼ë¡œ ê³ ì •í•˜ë©´ ëª©ë¡ ë’¤ë°”ë€” ë•Œ ì‹¤ìˆ˜í• ìˆ˜ë„)
                method : 'DELETE', //ìš”ì²­ ë°©ì‹ ì •í•˜ê¸°
            })
            .then((r)=>r.text()) //Responseì˜ bodyë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜
            .then((r)=>{
                e.target.parentElement.parentElement.style.display = 'none'   
            })   
        })
    }   
    </script>
</body>
</html>